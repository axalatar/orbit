<html>
   <head> </head>
   <body style="margin:0">
      <canvas id = "canvas"></canvas>
      <script>
         var canvas = document.getElementById('canvas');
         const ctx = canvas.getContext("2d");

         canvas.width = window.innerWidth;
         canvas.height = window.innerHeight;

         ctx.fillStyle = "black";
         ctx.fillRect(0, 0, canvas.width, canvas.height);


         var masses = [];

         var G = 0.0000000000000000001;

         let holding = false;
         canvas.addEventListener('mousedown', (e) => {
         holding = true;
         });
         
         canvas.addEventListener('mouseup', (e) => {
         holding = false;
         });

         canvas.addEventListener('mousemove', (e) => {
            if(holding) {
               masses.push([e.offsetX, e.offsetY, 0, 0])
            }
         })

         function pixel(x, y, c) {
            ctx.fillStyle = c;
            ctx.fillRect( x, y, 1, 1 );
         }

         function update_pos(i) {
            // update pos of mass at index i
            let x1 = masses[i][0]
            let y1 = masses[i][1]

            let vx = masses[i][2]
            let vy = masses[i][3]

            masses[i][0] += masses[i][2]
            masses[i][1] += masses[i][3]


            for(let i = 0; i < masses.length; i++) {
               let x2 = masses[i][0];
               let y2 = masses[i][1]

               let distsq = Math.pow(x1 - x2, 2) + Math.pow(y1 - y2, 2);

               if(!isFinite(distsq) || distsq <= 0) continue;

               let force = G / distsq;

               let dist = Math.sqrt(distsq)

               let x = force * (x2 / dist);
               let y = force * (y2 / dist);
               
               masses[i][2] += 0.1;
               masses[i][3] += y;
            }

            if(x1 > canvas.width || y1 > canvas.height || x1 < 0 || y1 < 0) {
               return false;
            }
            return true;
         }


         setInterval(() => {
            for(let i = masses.length-1; i >= 0; i--) {
               pixel(masses[i][0], masses[i][1], 'black')
               if(update_pos(i)) {
                  pixel(masses[i][0], masses[i][1], 'white')
               }
               else {
                  masses.splice(i, 1)
               }
               console.log(masses.length)
            }
         }, 1000)
      </script>
   </body>
</html>